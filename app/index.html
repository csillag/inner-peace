<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>The Search For Inner[Text] Peace</title>
  <link rel="stylesheet" href="css/app.css"/>
</head>
<body>
  <script src="lib/angular/angular.js"></script>
  <!-- In production use:
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.0.3/angular.min.js"></script>
  -->

  <!-- Allows for coffeescript compiling on the fly.                                    -->
  <!-- Not recommended for production use. See http://coffeescript.org/#scripts.        -->
  <script src="lib/diff_match_patch/diff_match_patch.js"></script>
  <script src="lib/coffeescript/coffee-script.js"></script>
  <script src="lib/domsearcher/domsearcher.coffee" type="text/coffeescript"></script>

  <script src="coffee/services.coffee" type="text/coffeescript"></script>
  <script src="coffee/controllers.coffee" type="text/coffeescript"></script>
  <script src="coffee/filters.coffee" type="text/coffeescript"></script>
  <script src="coffee/directives.coffee" type="text/coffeescript"></script>
  <script src="coffee/app.coffee" type="text/coffeescript"></script>

  <h1>The Search for Inner[Text] Peace</h1>
  
  <div ng-controller="SearchController">
    HTML input source:
    <select ng-model="sourceMode">
      <option value="local">Input HTML source manually</option>
      <option value="url">Fetch HTML from URL</option>
      <option value="page">Use this page</option>
    </select>


    <div id="source-spec">
      <div class="shown-{{sourceMode=='local'}}">
	<p>Test html source:</p>
	<textarea ng-model="localSource" id="source-editor"></textArea>
	<button ng-click="render()">Render it!</button>
      </div>

      <div class="shown-{{sourceMode=='page'}}">
	<p>OK, so you want to test out the stuff on this very page.</p>
      </div>
      
      <div class="shown-{{sourceMode=='url'}}">
	URL to fetch:
	<input ng-model="remoteURL">
	<p>(I have desabled this, because could not sort out same-origin policy issues for now.)</p>
      </div>
    </div>

    <div class="shown-{{sourceMode=='local' && renderSource != null}}">
      <h2>DOM rendered as:</h2>
      <div id="rendered-dom" ng-bind-html-unsafe="renderSource"></div>
    </div>
    
    <div class="shown-{{paths.length>0}}">
      Select DOM element to scan:
      <select ng-model="selectedPath" ng-options="path for path in paths"></select>
      <button ng-click="scan()">Scan!</button>
    </div>
    
    <div id="mappings-list" class="shown-{{mappings.length>0}}">
      <h2>Collected string indices:</h2>
      <input type="checkbox" ng-model="atomicOnly">Show only atomic elements</checkbox>
      <table border="1">
	<thead>
	  <tr>
	    <th>Path</th>
	    <th>Text</th>
	    <th>Start index</th>
	    <th>End index</th>
	    <th class="shown-{{!atomicOnly}}">Atomic</th>
	  </tr>
	</thead>
	<tbody>
	  <tr ng-repeat="mapping in mappings" class="shown-{{!atomicOnly || mapping.atomic}}">
	    <td>{{mapping.path}}</td>
	    <td>"{{mapping.innerText}}"</td>
	    <td>{{mapping.start}}</td>
	    <td>{{mapping.end}}</td>
	    <td class="shown-{{!atomicOnly}}">{{mapping.atomic | booleanCheckmark}}</td>
	  </tr>
	</tbody>
      </table>
    </div>

    <div id="search-input" class="shown-{{mappings.length>0}}">
      <form name="SearchForm">
	Search term:
	<input type="text" ng-model="searchTerm" required="true">
	Search position:
	<input type="number" ng-model="searchPos" min="0">
	<button ng-click="search()">Search!</button>
      </form>
    </div>

    <div id="search-results" class="shown-{{searchResults.length>0}}">
      {{searchResults}}
      <div id="search-matching-elements" class="shown-{{detailedResults.length>0}}">
	<p>Involved elements:</p>
	<table border="1">
	  <thead>
	    <tr>
	      <th>Path</th>
	      <th>Text</th>
	      <th>Full</th>
	      <th>From</th>
	      <th>Till</th>
	    </tr>
	  </thead>
	  <tbody>
	    <tr ng-repeat="match in detailedResults">
	      <td>{{match.path}}</td>
	      <td>{{match.text}}</td>
	      <td>{{match.full | booleanCheckmark}}</td>
	      <td>{{match.start}}</td>
	      <td>{{match.end}}</td>
	    </tr>
	  </tbody>
	</table>
      </div>
    </div>
  </div>
</body>
</html>
